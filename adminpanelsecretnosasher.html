 <!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chatroom Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 0px;
    }
    h1 { text-align: center; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0px;
      background: white;
      box-shadow: 0 0px 0px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #5a9e67;
      color: white;
    }
    button {
      padding: 5px 10px;
      margin: 0px;
      border: none;
      border-radius: 1px;
      cursor: pointer;
    }
    .edit-btn { background: #ffcc00; }
    .delete-btn { background: #ff4d4d; color: white; }
    .save-btn { background: #4CAF50; color: white; }
  </style>
</head>
<body>
  <table id="messagesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Message</th>
        <th>Time</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="messagesBody"></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, onChildAdded, update, remove } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    // SAME CONFIG AS CHATROOM
    const firebaseConfig = {
      apiKey: "AIzaSyBYJW83DPFsEBNM1wV_3SJ0sT8aerGPx7A",
      authDomain: "chatroomfunyay.firebaseapp.com",
      databaseURL: "https://chatroomfunyay-default-rtdb.firebaseio.com",
      projectId: "chatroomfunyay",
      storageBucket: "chatroomfunyay.firebasestorage.app",
      messagingSenderId: "741967066444",
      appId: "1:741967066444:web:b6e386b842d3c29febcbe9",
      measurementId: "G-4CXD16WBVL"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const tableBody = document.getElementById("messagesBody");

    onChildAdded(ref(db, "messages"), (snapshot) => {
      const data = snapshot.val();
      const key = snapshot.key;

      const row = document.createElement("tr");

      const nameCell = document.createElement("td");
      nameCell.textContent = data.name || "Anonymous";

      const msgCell = document.createElement("td");
      msgCell.textContent = data.text || "(no message)";

      const timeCell = document.createElement("td");
      timeCell.textContent = new Date(data.timestamp).toLocaleString();

      const actionsCell = document.createElement("td");

      // Edit Button
      const editBtn = document.createElement("button");
      editBtn.textContent = "Edit";
      editBtn.classList.add("edit-btn");
      editBtn.onclick = () => {
        const newText = prompt("Edit message:", msgCell.textContent);
        if (newText !== null) {
          update(ref(db, "messages/" + key), { text: newText });
          msgCell.textContent = newText;
        }
      };

      // Delete Button
      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.classList.add("delete-btn");
      deleteBtn.onclick = () => {
        if (confirm("Are you sure you want to delete this message?")) {
          remove(ref(db, "messages/" + key));
          row.remove();
        }
      };

      actionsCell.appendChild(editBtn);
      actionsCell.appendChild(deleteBtn);

      row.appendChild(nameCell);
      row.appendChild(msgCell);
      row.appendChild(timeCell);
      row.appendChild(actionsCell);

      tableBody.appendChild(row);
    });
  </script>
</body>
</html>
